<html>
    <head>
        <title>Pure Air</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
        <style>
            .row {
                --bs-gutter-x: 0;
            }
        </style>

    </head>
    <body style="height: 100vh; font-family: 'Inter', sans-serif;">

        <nav class="navbar navbar-expand-lg navbar-light bg-light px-5">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Pure Air</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="text-end nav-item">
                    <a class="btn btn-primary" href="index.html">Pollution map</a>
                </div>
            </div>
        </nav>

        
            <div style="height: 100%;" class="row">
                <div style="background-color: #F1F1F1;" class="col d-flex flex-column justify-content-center align-items-center">                
                    <div class="card" style="width: 350px; height: 350px; border: 1px solid #DCE7ED; border-radius: 24px;">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2" style="font-size: 24px; color: #1F3E4F; padding-bottom: 60px;">
                                Inside temperature
                            </h6>
                            <h5 style="font-size: 56px; color: #1F3E4F"> 
                                <span id="in_temp_text">__</span>&deg
                                <span style="font-size: 16px; color: #8F9EA7; margin-left: -30px;">
                                    /<span id="in_temp_text_max">__</span>&deg
                                </span>
                            </h5>
                          
                            <p style="font-size: 16px; color: #1F3E4F">We reccomend keeping the house temperature between 21&deg and 22&deg. <a href="https://www.endesa.com/en/blogs/endesa-s-blog/air-conditioning/home-recommended-temperature">?</a></p>

                        </div>
                    </div>
                    <div class="card mt-5" style="width: 350px; height: 350px; border: 1px solid #DCE7ED; border-radius: 24px;">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2" style="font-size: 24px; color: #1F3E4F; padding-bottom: 60px;">
                                CO
                                <span style="font-size: 16px; color: #1F3E4F; margin-left: -6px;">
                                    2
                                </span>
                            </h6>
                            <h5 style="font-size: 56px; color: #1F3E4F"> 
                                <span id="co2_text">____</span>
                                <span style="font-size: 16px; color: #8F9EA7; margin-left: -12px;">
                                    PPM
                                </span>
                            </h5>

                            <p style="font-size: 16px; color: #1F3E4F">The typical value for a well ventilated indoor space is between 400-1,000ppm. </p>
                        </div>
                    </div>
                </div>

                <div class="col d-flex flex-column justify-content-center align-items-center">
                    <div class="card" style="width: 350px; height: 350px; border: 1px solid #DCE7ED; border-radius: 24px;">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2" style="font-size: 24px; color: #1F3E4F; padding-bottom: 60px;">
                                Outside temperature
                            </h6>
                            <h5 style="font-size: 56px; color: #1F3E4F"> 
                                <span id="out_temp_now">__</span>&deg
                                <span style="font-size: 16px; color: #8F9EA7; margin-left: -30px;">
                                    /<span id="out_temp_min">__</span>&deg
                                </span>
                            </h5>
                          
                            <p style="font-size: 16px; color: #1F3E4F">If the outside temperature is greatly different from your house's you might waste energy by ventilating your rooms.</p>
                        </div>
                    </div>
                    <div class="card mt-5" style="width: 350px; height: 350px; border: 1px solid #DCE7ED; border-radius: 24px;">
                        <div class="card-body text-center">
                            <h6 class="card-subtitle mb-2" style="font-size: 24px; color: #1F3E4F; padding-bottom: 60px;">
                                Outside pollution
                            </h6>
                            <h5 style="font-size: 56px; color: #1F3E4F"> 
                                <span id="aqi_text">___</span>
                                <span style="font-size: 16px; color: #8F9EA7; margin-left: -12px;">
                                    AQI
                                </span>
                            </h5>
                          
                            <p style="font-size: 16px; color: #1F3E4F">The Air Quality Index is a standard that defines the outside pollution levels, a level below 100 is considered acceptable.</p>
                        </div>
                    </div>
                </div>

                <div class="col-5 d-flex align-items-center">
                    <div>
                        <h6 class="card-subtitle" style="font-size: 18px; line-height: 24px; letter-spacing: -0.6px; color: #1F3E4F; padding-bottom: 35px;">
                            Air quality monitoring system
                        </h6>
                        <h5 style="font-size: 56px; color: #1F3E4F; line-height: 60px; font-weight: 600; letter-spacing: -1.8px;"> 
                            Pure Air.
                        </h5>
                      
                        <p style="font-size: 14px; color: #8F9EA7; line-height: 20px; letter-spacing: -0.14px; margin-top: 24px;">
                            Refreshing the air in your room can reduce the accumulation of CO2 <br>
                            and improve your quality of life, on the other hand by opening the <br/>
                            windows you will lose energy from your house with the risk of letting <br/>
                            city pollution getting inside. <br><br>
                            With Pure Air you can evaluate the best moment to open your window.
                        </p>
                        <div
                            class="alert" 
                            role="alert" 
                            id="alert_change_color"
                            style="display: inline-block; line-height: 30px; width: 445px; margin-top: 20px; border-radius: 10px;"
                        >
                            <span id="can_open_window">Now you can open your window</span> <img style="width: 50px; float: right;" src="img/air.svg"/>
                        </div>

                        <h5 style="font-size: 56px; color: #1F3E4F; margin-top: 55px;"> 
                            <span id="wh_text">__</span>
                            <span style="font-size: 24px; color: #1F3E4F; margin-left: -12px;">
                                W/h
                            </span>
                        </h5>
                        <p style="font-weight: 500; line-height: 28px; font-size: 18px; color: #1F3E4F; margin-top: 16px; letter-spacing: -0.4px;">
                            loss of energy by <br/>
                            opening the window <br/>
                            for five minutes.
                        </p>
                    </div>
                </div>
              </div>
              <div class="modal bg-dark" id="uuid_modal" style="display: none; opacity: 0">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="staticBackdropLabel">Pure Air ID</h5>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label for="uuid_val" class="col-form-label">Please insert the Pure Air ID associated with your device:</label>
                                    <input type="text" class="form-control" id="uuid_val" autofocus>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <a type="button" href="index.html" class="btn btn">Go back</a>
                            <button type="button" class="btn btn-primary" id="uuid_send">Send</button>
                        </div>
                    </div>
                </div>
            </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
        <script>
            // UUID popup
        function show() {
            $(uuid_modal)
                .css({
                    top: "-=30px"
                })
                .show()
                .animate({
                    opacity: 1,
                    top: "+=30px"
                })
        }
        function hide() {
            $(uuid_modal)
                .animate({
                    opacity: 0,
                    top: "-=30px"
                }, function (){
                    $(uuid_modal).css({
                        top: "+=30px"
                    }).hide()
                });
        }

        let uuid_val = document.getElementById('uuid_val');
        $(uuid_val).on("click", function () {
            $(this).removeClass("alert-danger");
        })
        var uuid_modal = document.getElementById('uuid_modal');
        var uuid_send = document.getElementById('uuid_send');
        uuid_send.addEventListener('click', function (event) {
            $.ajax({
                url: "/v1/iot/getDeviceData/" + uuid_val.value,
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    startDate: "2021-06-12 10:00:00",
                    endDate: "2022-06-16 10:00:00"
                }),
                success: function (data) {
                    window.localStorage.setItem("duiid", uuid_val.value)
                    hide();
                    load();
                },
                error: function (data) {
                    $(uuid_val).addClass("alert-danger");
                }
            });
        });
        var uuid_value;
        if (window.localStorage.getItem("duiid") === null) {
            show()
        } else {
            load();
        }
        var SENSOR_DATA = {};

        function load(){
            uuid_value = window.localStorage.getItem("duiid");
            $.ajax({
                url: `/v1/iot/getHomeAssistant/${uuid_value}`,
                type: "GET",
                success: (data) => {
                    $("#co2_text").text(data.co2);
                    $("#in_temp_text").text(data.in_temp);
                    $("#in_temp_text_max").text(data.in_temp + 3);

                    let out_temp = data.out_temp,
                        in_temp = data.in_temp;

                    $("#out_temp_now").text(out_temp);
                    $("#out_temp_min").text(out_temp - 2);
                    $("#aqi_text").text(data.lpo_time);

                    let wh = Math.abs(in_temp - out_temp)*20;
                    $("#wh_text").text(wh);

                    let green_hex = "#E9F6EC",
                        red_hex = "#FFEAEA";
                    
                    if(wh < 100){
                        $("#can_open_window").text("Now you can open your window")
                        $("#alert_change_color").css({background: green_hex})
                    } else {
                        $("#can_open_window").text("Now you shouldn't open your window")
                        $("#alert_change_color").css({background: red_hex})
                    }
                    
                    
                },
                error: (e) => {
                    console.error(e);
                }
            })
        }
        </script>
    </body>
</html>